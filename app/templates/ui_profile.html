{% extends "base.html" %}
{% block content %}

<style>
  .pro-header {
    text-align: center;
    padding: 20px;
    background: #fff;
    border-bottom: 1px solid #eee;
  }

  .pro-avatar {
    width: 80px;
    height: 80px;
    margin: 0 auto 10px;
    display: block;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid #fff;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .pro-name {
    font-weight: 900;
    font-size: 22px;
    margin-bottom: 4px;
    letter-spacing: -0.5px;
  }

  .pro-badge {
    display: inline-block;
    background: #eff6ff;
    color: #1d4ed8;
    font-weight: bold;
    font-size: 12px;
    padding: 4px 10px;
    border-radius: 99px;
  }

  .pro-section {
    margin-top: 10px;
    background: #fff;
    padding: 15px;
    border-top: 1px solid #eee;
    border-bottom: 1px solid #eee;
  }

  .section-title {
    font-weight: 800;
    font-size: 15px;
    text-transform: uppercase;
    color: #64748b;
    margin-bottom: 10px;
    letter-spacing: 0.5px;
  }

  .offer-card {
    display: block;
    text-decoration: none;
    color: inherit;
    background: #f9fafb;
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid #eee;
    margin-bottom: 12px;
  }

  .offer-video {
    width: 100%;
    height: 180px;
    background: #000;
    object-fit: cover;
    display: block;
  }

  .offer-body {
    padding: 12px;
  }

  .offer-title {
    font-weight: 800;
    font-size: 16px;
    margin-bottom: 4px;
  }

  .offer-price {
    font-weight: 700;
    color: #16a34a;
    float: right;
  }
</style>

<div class="pro-header">
  <img src="{{ p.user_photo }}" class="pro-avatar">
  <div class="pro-name">{{ p.user_name }}</div>
  <div class="pro-badge">{{ p.type }}</div>
  {% if p.available %}
  <span class="badge text-bg-success rounded-pill ms-1">Disponible ahora</span>
  {% endif %}

  {% if user and user.profile_id == p.id %}
  <div class="mt-3">
    <a class="btn btn-outline-dark btn-sm pill fw-bold px-4" href="/ui/profile/{{ p.id }}/edit">
      ‚úèÔ∏è Editar mi perfil
    </a>
  </div>
  {% endif %}
</div>

<div class="pro-section">
  <div class="section-title">Sobre m√≠</div>
  <div class="text-secondary" style="line-height:1.6;">
    {{ p.desc or "Este profesional no ha a√±adido una descripci√≥n." }}
  </div>
</div>

<div class="pro-section">
  <div class="section-title">Mis Servicios ({{ offers|length }})</div>

  {% if offers|length == 0 %}
  <div class="text-center text-muted py-3">No hay ofertas publicadas.</div>
  {% endif %}

  {% for o in offers %}
  <div class="offer-card position-relative" id="offer-{{ o.id }}">
    {% if user and user.profile_id == p.id %}
    <button class="btn btn-sm btn-danger position-absolute top-0 end-0 m-2 rounded-circle"
      onclick="deleteOffer({{ o.id }})"
      style="z-index:10; width:32px; height:32px; display:flex; align-items:center; justify-content:center;">
      üóë
    </button>
    {% endif %}

    {% if o.video_path %}
    <video class="offer-video" controls playsinline poster="https://via.placeholder.com/400x200?text=Video+Oferta">
      <source src="{{ o.video_path }}" type="video/mp4">
      <source src="{{ o.video_path }}" type="video/quicktime">
      Tu m√≥vil no soporta este v√≠deo.
    </video>
    {% elif o.photo_path %}
    <img src="{{ o.photo_path }}" class="offer-video" style="object-fit:cover;">
    {% else %}
    <div class="offer-video d-flex align-items-center justify-content-center text-white">
      (Sin visualizaci√≥n)
    </div>
    {% endif %}

    <div class="offer-body">
      {% if o.price %}
      <div class="offer-price">{{ o.price | format_price }} ‚Ç¨</div>
      {% endif %}
      <div class="offer-title">{{ o.title }}</div>
      <div class="text-secondary small mb-2">{{ o.description }}</div>
      <div class="text-muted small">{{ o.category }}</div>
    </div>
  </div>
  {% endfor %}
</div>

<div class="p-3 mt-2 mb-4">
  {% if not (user and user.profile_id == p.id) %}
  <a class="btn btn-dark w-100 pill py-3 fw-bold"
    href="https://wa.me/{{ p.phone }}?text=Hola,%20he%20visto%20tu%20perfil%20en%20Ofrezco" target="_blank">
    Contactar con {{ p.user_name }}
  </a>
  {% endif %}
</div>

<script>
  async function deleteOffer(id) {
    if (!confirm("¬øSeguro que quieres borrar esta oferta?")) return;
    try {
      const r = await fetch(`/api/v1/offers/${id}`, { method: 'DELETE' });
      if (r.ok) {
        document.getElementById(`offer-${id}`).remove();
      } else {
        alert("Error al borrar");
      }
    } catch (e) { alert("Error: " + e); }
  }
</script>

{% endblock %}